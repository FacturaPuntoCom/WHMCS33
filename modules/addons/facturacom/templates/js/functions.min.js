$(function(){(function a(){$(".btn-send-email").unbind().on("click",function(a){a.preventDefault(),$(this).html('<span class="glyphicon glyphicon-refresh"></span> Enviando factura'),$(".btn-send-email").attr("disabled",!0);var n=$("#systemURL").val(),e={function:"sendInvoice",uid:$(this).attr("data-uid"),version:$(this).attr("data-version")};$.ajax({data:e,url:n+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(a){$(".btn-send-email").attr("disabled",!1),$(".btn-send-email").html('<span class="glyphicon glyphicon-envelope"></span> Enviar por correo'),$("#facturaModal #facturaModalText").html(a.message),$("#facturaModal").modal()}})}),$(".btn-cancel-invoice").unbind().on("click",function(n){n.preventDefault(),$("#motivo").val("01"),$("#uid").val(""),$("#grupoUID").show();var e=$(this);$("#facturaModalConfirm").modal({backdrop:"static",keyboard:!1}),$("#cancelInvoiceBtn").unbind().on("click",function(n){let t=$("#motivo").val(),o=$("#uid").val();if("01"==t&&""==o)return!1;$("#facturaModalConfirm").modal("hide"),e.html('<span class="glyphicon glyphicon-refresh"></span> Cancelando'),$(".btn-cancel-invoice").attr("disabled",!0);var r=$("#systemURL").val(),d={function:"cancelInvoice",uid:e.attr("data-uid"),motivo:t,folioSustituto:o,version:e.attr("data-version")};$.ajax({data:d,url:r+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(n){var e;"error"==n.response?$("#facturaModal #facturaModalText").html("Error al cancelar: "+n.message):$("#facturaModal #facturaModalText").html(n.message),$("#facturaModal").modal(),e=$("#systemURL").val(),$.ajax({data:{function:"loadInvoicesTable"},url:e+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(n){var t,o=n.data,r="";for(t=0;t<o.length;++t){var d="enviada"==o[t].Status?"label-success":"label-danger";r+=`<tr>\n                                                                    <td>${o[t].Folio}</td>\n                                                                    <td>${o[t].FechaTimbrado}</td>\n                                                                    <td>${o[t].RazonSocialReceptor}</td>\n                                                                    <td><a href="${e}admin/clientssummary.php?userid=${o[t].ReferenceClient}" target="_blank">${o[t].ReferenceClient}</a></td>\n                                                                    <td><a href="${e}admin/orders.php?action=view&id=${o[t].NumOrder?o[t].NumOrder:""}" target="_blank">${o[t].NumOrder?o[t].NumOrder:""}</a></td>\n                                                                    <td>$ ${(new Intl.NumberFormat).format(o[t].Total)}</td>\n                                                                    <td><span class="label ${d}">${o[t].Status}</span></td>\n                                                                    <td><a href="${e}modules/addons/facturacom/lib/downloadhandler.php?uid=${o[t].UID}&type=pdf" target="_blank">PDF</a></td>\n                                                                    <td><a href="${e}modules/addons/facturacom/lib/downloadhandler.php?uid=${o[t].UID}&type=xml" target="_blank">XML</a></td>\n                                                                    <td>\n                                                                    `,"enviada"==o[t].Status&&(r+=`<a href="#" class="btn-send-email btn btn-info" data-uid="${o[t].UID}" data-version="${o[t].Version}">\n                                                                        <span class="glyphicon glyphicon-envelope"></span>Enviar por correo\n                                                                  </a>\n                                                                  <a href="#" class="btn-cancel-invoice btn btn-danger" data-uid="${o[t].UID}" data-version="${o[t].Version}">\n                                                                        <span class="glyphicon glyphicon-ban-circle"></span>Cancelar\n                                                                  </a>`),r+="</td></tr>"}$("#adminInvoices tbody").html(r),a()}})},error:function(a){$("#facturaModal #facturaModalText").html(a.message),$("#facturaModal").modal()},complete:function(){$(".btn-cancel-invoice").attr("disabled",!1),$(".btn-cancel-invoice").html('<span class="glyphicon glyphicon-ban-circle"></span> Cancelar')}})}),$("#motivo").unbind().on("change",function(){"01"==this.value?$("#grupoUID").show():$("#grupoUID").hide()})})})(),$("#adminInvoices").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[6,7,8,9]}],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}})});