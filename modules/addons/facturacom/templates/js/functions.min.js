$(function(){function a(){$(".btn-send-email").unbind().on("click",function(a){a.preventDefault(),$(this).html('<span class="glyphicon glyphicon-refresh"></span> Enviando factura'),$(".btn-send-email").attr("disabled",!0);var e=$("#systemURL").val(),n={function:"sendInvoice",uid:$(this).attr("data-uid"),version:$(this).attr("data-version")};$.ajax({data:n,url:e+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(a){$(".btn-send-email").attr("disabled",!1),$(".btn-send-email").html('<span class="glyphicon glyphicon-envelope"></span> Enviar por correo'),$("#facturaModal #facturaModalText").html(a.message),$("#facturaModal").modal()}})}),$(".btn-cancel-invoice").unbind().on("click",function(e){e.preventDefault(),$("#motivo").val("01"),$("#uid").val(""),$("#grupoUID").show();var n=$(this);$("#facturaModalConfirm").modal({backdrop:"static",keyboard:!1}),$("#cancelInvoiceBtn").unbind().on("click",function(e){let t=$("#motivo").val(),o=$("#uid").val();if("01"==t&&""==o)return!1;$("#facturaModalConfirm").modal("hide"),n.html('<span class="glyphicon glyphicon-refresh"></span> Cancelando'),$(".btn-cancel-invoice").attr("disabled",!0);var r=$("#systemURL").val(),s={function:"cancelInvoice",uid:n.attr("data-uid"),motivo:t,folioSustituto:o,version:n.attr("data-version")};$.ajax({data:s,url:r+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){var n;"error"==e.response?$("#facturaModal #facturaModalText").html("Error al cancelar: "+e.message):$("#facturaModal #facturaModalText").html(e.message),$("#facturaModal").modal(),n=$("#systemURL").val(),$.ajax({data:{function:"loadInvoicesTable"},url:n+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){var t,o=e.data,r="";for(t=0;t<o.length;++t){var s="enviada"==o[t].Status?"label-success":"label-danger";r+='<tr><th scope="row">'+(t+1)+"</th><td>"+o[t].Folio+"</td><td>"+o[t].FechaTimbrado+"</td><td>"+o[t].Receptor+'</td><td><a href="'+n+"admin/clientssummary.php?userid="+o[t].ReferenceClient+'" target="_blank">'+o[t].ReferenceClient+'</a></td><td><a href="'+n+"admin/orders.php?action=view&id="+o[t].NumOrder+'" target="_blank">'+o[t].NumOrder+'</a></td><td><span class="label '+s+'">'+o[t].Status+'</span></td><td><a href="'+n+"modules/addons/facturacom/lib/downloadhandler.php?uid="+o[t].UID+'&type=pdf" target="_blank">PDF</a></td><td><a href="'+n+"modules/addons/facturacom/lib/downloadhandler.php?uid="+o[t].UID+'&type=xml" target="_blank">XML</a></td>',"enviada"==o[t].Status?r+='<td><a href="#" class="btn-send-email btn btn-info" data-uid="'+o[t].UID+'" data-version="'+o[t].Version+'"><span class="glyphicon glyphicon-envelope"></span> Enviar por correo</a><a href="#" class="btn-cancel-invoice btn btn-danger" data-uid="'+o[t].UID+'" data-version="'+o[t].Version+'"><span class="glyphicon glyphicon-ban-circle"></span> Cancelar</a></td>':r+="<td>&nbsp;</td>",r+="</tr>"}$("#adminInvoices tbody").html(r),a()}})},error:function(a){$("#facturaModal #facturaModalText").html(a.message),$("#facturaModal").modal()},complete:function(){$(".btn-cancel-invoice").attr("disabled",!1),$(".btn-cancel-invoice").html('<span class="glyphicon glyphicon-ban-circle"></span> Cancelar')}})}),$("#motivo").unbind().on("change",function(){"01"==this.value?$("#grupoUID").show():$("#grupoUID").hide()})})}a(),$("#adminInvoices").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[6,7,8,9]}],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}})});