$(function(){a();function a(){$(".btn-send-email").unbind().on("click",function(g){g.preventDefault();$(this).html('<span class="glyphicon glyphicon-refresh"></span> Enviando factura');$(".btn-send-email").attr("disabled",true);var c=$("#systemURL").val();var h=$(this).attr("data-uid");var f=$(this).attr("data-version");var d={"function":"sendInvoice",uid:h,version:f};$.ajax({data:d,url:c+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){$(".btn-send-email").attr("disabled",false);$(".btn-send-email").html('<span class="glyphicon glyphicon-envelope"></span> Enviar por correo');$("#facturaModal #facturaModalText").html(e.message);$("#facturaModal").modal()}})});$(".btn-cancel-invoice").unbind().on("click",function(d){d.preventDefault();var c=$(this);$("#facturaModalConfirm").modal({backdrop:"static",keyboard:false}).one("click","#cancelInvoiceBtn",function(i){c.html('<span class="glyphicon glyphicon-refresh"></span> Cancelando');$(".btn-cancel-invoice").attr("disabled",true);var f=$("#systemURL").val();var j=c.attr("data-uid");var h=$(this).attr("data-version");var g={"function":"cancelInvoice",uid:j,version:h};$.ajax({data:g,url:f+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){b();$(".btn-cancel-invoice").attr("disabled",false);$(".btn-cancel-invoice").html('<span class="glyphicon glyphicon-ban-circle"></span> Cancelar');$("#facturaModal #facturaModalText").html(e.message);$("#facturaModal").modal()}})})})}function b(){var c=$("#systemURL").val();var d={"function":"loadInvoicesTable"};$.ajax({data:d,url:c+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){var i=e.data;var g;var h="";for(g=0;g<i.length;++g){var f=(i[g].Status=="enviada"?"label-success":"label-danger");h+='<tr><th scope="row">'+(g+1)+"</th><td>"+i[g].Folio+"</td><td>"+i[g].FechaTimbrado+"</td><td>"+i[g].Receptor+'</td><td><a href="'+c+"admin/clientssummary.php?userid="+i[g].ReferenceClient+'" target="_blank">'+i[g].ReferenceClient+'</a></td><td><a href="'+c+"admin/orders.php?action=view&id="+i[g].NumOrder+'" target="_blank">'+i[g].NumOrder+'</a></td><td><span class="label '+f+'">'+i[g].Status+'</span></td><td><a href="'+c+"modules/addons/facturacom/lib/downloadhandler.php?uid="+i[g].UID+'&type=pdf" target="_blank">PDF</a></td><td><a href="'+c+"modules/addons/facturacom/lib/downloadhandler.php?uid="+i[g].UID+'&type=xml" target="_blank">XML</a></td>';if(i[g].Status=="enviada"){h+='<td><a href="#" class="btn-send-email btn btn-info" data-uid="'+i[g].UID+'" data-version="'+i[g].Version+'"><span class="glyphicon glyphicon-envelope"></span> Enviar por correo</a><a href="#" class="btn-cancel-invoice btn btn-danger" data-uid="'+i[g].UID+'" data-version="'+i[g].Version+'"><span class="glyphicon glyphicon-ban-circle"></span> Cancelar</a></td>'}else{h+="<td>&nbsp;</td>"}h+="</tr>"}$("#adminInvoices tbody").html(h);a()}})}$("#adminInvoices").DataTable({aoColumnDefs:[{bSortable:false,aTargets:[6,7,8,9]}],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}})});