$((function(){String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,(function(e){return e.toUpperCase()}))},$("#tableClientInvoicesList").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[5,6,7]}],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}}),$("#tableClientToInvoicesList").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[0,1,2]}],pageLength:10,order:[[0,"desc"]],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}}),$("#fiscal-rfc").bind("keypress",(function(e){var a=e.keyCode||e.which;if(!(8==a||a>=35&&a<=40)){var n=new RegExp("^[a-zA-Z0-9_&]*$"),o=String.fromCharCode(e.charCode?e.charCode:e.which);return n.test(o)?void 0:(e.preventDefault(),!1)}})),$("#input-numerocuenta").bind("keypress",(function(e){var a=e.which?e.which:e.keyCode;return!(8!=a&&46!=a&&a>31&&(a<48||a>57)||$(this).val().length>=4)})),$(".input-upper").on("input",(function(e){var a=$(this),n=a[0].selectionStart;$(this).val((function(e,a){return a.toUpperCase()})),a[0].selectionStart=a[0].selectionEnd=n})),$("#modalForm").unbind().on("show.bs.modal",(function(e){var a=$(e.relatedTarget),n=a.data("uid"),o=a.data("items");$(this).find(".modal-title").text("Facturar pedido #"+n),$("#orderNum").val(n),$("#orderItems").val(o)})),$("#fiscal-cp").change((function(){$("#cp-loading").fadeIn();var e=$(this).val(),a=$("#systemURL").val(),n={function:"getLocation",cp:e};$.ajax({data:n,url:a+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){var a,n,o;$("#cp-loading").fadeOut(),e&&(a=e,n=$("#modalForm"),o=a.colonias.split(","),n.find("#fiscal-colonia").val(o[0]),n.find("#fiscal-municipio").val(a.ciudad),n.find("#fiscal-estado").val(a.estado))}})})),$("#fiscal-rfc").change((function(){$("#rfc-loading").fadeIn();var e=$(this).val(),a=$("#systemURL").val(),n={function:"getClient",rfc:e};$.ajax({data:n,url:a+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){if($("#rfc-loading").fadeOut(),console.log(e),"success"==e.status){var a=e.Data;n=a,(o=$("#modalForm")).find("#clientUID").val(n.UID),o.find("#general-nombre").val(n.Contacto.Nombre),o.find("#general-apellidos").val(n.Contacto.Apellidos),o.find("#general-email").val(n.Contacto.Email),o.find("#fiscal-telefono").val(n.Contacto.Telefono),o.find("#fiscal-nombre").val(n.RazonSocial),o.find("#fiscal-calle").val(n.Calle),o.find("#fiscal-exterior").val(n.Numero),o.find("#fiscal-interior").val(n.Interior),o.find("#fiscal-colonia").val(n.Colonia),o.find("#fiscal-municipio").val(n.Ciudad),o.find("#fiscal-estado").val(n.Estado),o.find("#fiscal-cp").val(n.CodigoPostal),o.find("#fiscal-regimen option").filter((function(){return $(this).text()==n.Regimen})).prop("selected",!0),$(".f-edit").attr("disabled",!1)}else $(".f-edit").attr("disabled",!0),function(e){var a=$("#modalForm");a.find("#clientUID").val(""),a.find("#general-nombre").val(""),a.find("#general-apellidos").val(""),a.find("#general-email").val(""),a.find("#fiscal-telefono").val(""),a.find("#fiscal-nombre").val(""),a.find("#fiscal-calle").val(""),a.find("#fiscal-exterior").val(""),a.find("#fiscal-interior").val(""),a.find("#fiscal-colonia").val(""),a.find("#fiscal-municipio").val(""),a.find("#fiscal-estado").val(""),a.find("#fiscal-cp").val("")}();var n,o}})})),$("#step-two-button-back-two").unbind().on("click",(function(e){$("#step-two").hide(),$("#step-one").fadeIn("slow")})),$("#invoice-button-next").unbind().on("click",(function(e){e.preventDefault(),$("#step-one").hide().delay(3e3),$("#step-two").fadeIn("slow")})),$("#paymentMethod").change((function(){var e=$("#paymentMethod option:selected").val();2==e||3==e||4==e||28==e||29==e?$("#num-cta-box").fadeIn("fast"):$("#num-cta-box").fadeOut("fast")})),$("#invoice-button-create").unbind().on("click",(function(e){if(e.preventDefault(),!$("#fiscalDataForm").isValid())return console.log("Formulario no se puede enviar"),!1;var a=$(this);$(this).attr("disabled",!0),$(this).val("Procesando");var n=$("#fiscalDataForm").serializeArray(),o={};$.map(n,(function(e,a){o[e.name]=e.value}));var t=$("#systemURL").val(),i=$("#serieInvoices").val(),r=$("#clientW").val(),s=$("#orderNum").val(),l=$("#paymentMethod option:selected").val(),d=$("#UsoCFDI").val(),c=$("#orderItems").val(),f=$("#input-numerocuenta").val(),u={function:"createInvoice",clientData:o,serieInvoices:i,orderNum:s,orderItems:c,clientW:r,paymentMethod:l,numerocuenta:f,UsoCFDI:d};$.ajax({data:u,url:t+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){$("#error_message_end").hide(),"success"==e.response?($("#error_message_end").css("color","green"),$("#error_message_end").html(e.message),$("#error_message_end").show()):($("#error_message_end").html(e.message),$("#error_message_end").css("color","red"),$("#error_message_end").show(),a.removeAttr("disabled"),a.val("Crear factura")),$(this).val("Facturar"),$(this).attr("disabled",!1),"success"==e.response&&window.setTimeout((function(){location.reload()}),5e3)}})}))}));