$(function(){String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(d){return d.toUpperCase()})};$("#tableClientInvoicesList").DataTable({aoColumnDefs:[{bSortable:false,aTargets:[5,6,7]}],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}});$("#tableClientToInvoicesList").DataTable({aoColumnDefs:[{bSortable:false,aTargets:[0,1,2]}],pageLength:10,order:[[0,"desc"]],language:{decimal:"",emptyTable:"No hay información disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}});$("#fiscal-rfc").bind("keypress",function(f){var g=f.keyCode||f.which;if(g==8||(g>=35&&g<=40)){return}var e=new RegExp("^[a-zA-Z0-9_&]*$");var d=String.fromCharCode(!f.charCode?f.which:f.charCode);if(!e.test(d)){f.preventDefault();return false}});$("#input-numerocuenta").bind("keypress",function(d){var f=(d.which)?d.which:d.keyCode;if(f!=8&&f!=46&&f>31&&(f<48||f>57)){return false}var e=$(this).val().length;if(e>=4){return false}return true});$(".input-upper").on("input",function(d){var e=$(this);var f=e[0].selectionStart;$(this).val(function(g,h){return h.toUpperCase()});e[0].selectionStart=e[0].selectionEnd=f});$("#modalForm").unbind().on("show.bs.modal",function(g){var e=$(g.relatedTarget);var h=e.data("uid");var d=e.data("items");var f=$(this);f.find(".modal-title").text("Facturar pedido #"+h);$("#orderNum").val(h);$("#orderItems").val(d)});$("#fiscal-cp").change(function(){$("#cp-loading").fadeIn();var f=$(this).val();var d=$("#systemURL").val();var e={"function":"getLocation",cp:f};$.ajax({data:e,url:d+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(g){$("#cp-loading").fadeOut();if(g){b(g)}}})});function b(d){var e=$("#modalForm");var f=d.colonias.split(",");e.find("#fiscal-colonia").val(f[0]);e.find("#fiscal-municipio").val(d.ciudad);e.find("#fiscal-estado").val(d.estado)}$("#fiscal-rfc").change(function(){$("#rfc-loading").fadeIn();var d=$(this).val();var e=$("#systemURL").val();var f={"function":"getClient",rfc:d};$.ajax({data:f,url:e+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(h){$("#rfc-loading").fadeOut();console.log(h);if(h.status=="success"){var g=h.Data;a(g);$(".f-edit").attr("disabled",false)}else{$(".f-edit").attr("disabled",true);c(0)}}})});$("#step-two-button-back-two").unbind().on("click",function(d){$("#step-two").hide();$("#step-one").fadeIn("slow")});$("#invoice-button-next").unbind().on("click",function(d){d.preventDefault();$("#step-one").hide().delay(3000);$("#step-two").fadeIn("slow")});$("#paymentMethod").change(function(){var d=$("#paymentMethod option:selected").val();if(d==2||d==3||d==4||d==28||d==29){$("#num-cta-box").fadeIn("fast")}else{$("#num-cta-box").fadeOut("fast")}});$("#invoice-button-create").unbind().on("click",function(p){p.preventDefault();var d=$("#fiscalDataForm");if(!d.isValid()){console.log("Formulario no se puede enviar");return false}var j=$(this);$(this).attr("disabled",true);$(this).val("Procesando");var i=$("#fiscalDataForm").serializeArray();var q={};$.map(i,function(s,e){q[s.name]=s.value});var l=$("#systemURL").val();var k=$("#serieInvoices").val();var g=$("#clientW").val();var m=$("#orderNum").val();var o=$("#paymentMethod option:selected").val();var n=$("#UsoCFDI").val();var h=$("#orderItems").val();var f=$("#input-numerocuenta").val();var r={"function":"createInvoice",clientData:q,serieInvoices:k,orderNum:m,orderItems:h,clientW:g,paymentMethod:o,numerocuenta:f,UsoCFDI:n,};$.ajax({data:r,url:l+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(e){$("#error_message_end").hide();if(e.response=="success"){$("#error_message_end").css("color","green");$("#error_message_end").html(e.message);$("#error_message_end").show()}else{$("#error_message_end").html(e.message);$("#error_message_end").css("color","red");$("#error_message_end").show();j.removeAttr("disabled");j.val("Crear factura")}$(this).val("Facturar");$(this).attr("disabled",false);if(e.response=="success"){window.setTimeout(function(){location.reload()},5000)}}})});function c(d){var e=$("#modalForm");if(d==0){e.find("#clientUID").val("");e.find("#general-nombre").val("");e.find("#general-apellidos").val("");e.find("#general-email").val("");e.find("#fiscal-telefono").val("");e.find("#fiscal-nombre").val("");e.find("#fiscal-calle").val("");e.find("#fiscal-exterior").val("");e.find("#fiscal-interior").val("")}e.find("#fiscal-colonia").val("");e.find("#fiscal-municipio").val("");e.find("#fiscal-estado").val("");e.find("#fiscal-cp").val("")}function a(d){var e=$("#modalForm");e.find("#clientUID").val(d.UID);e.find("#general-nombre").val(d.Contacto.Nombre);e.find("#general-apellidos").val(d.Contacto.Apellidos);e.find("#general-email").val(d.Contacto.Email);e.find("#fiscal-telefono").val(d.Contacto.Telefono);e.find("#fiscal-nombre").val(d.RazonSocial);e.find("#fiscal-calle").val(d.Calle);e.find("#fiscal-exterior").val(d.Numero);e.find("#fiscal-interior").val(d.Interior);e.find("#fiscal-colonia").val(d.Colonia);e.find("#fiscal-municipio").val(d.Ciudad);e.find("#fiscal-estado").val(d.Estado);e.find("#fiscal-cp").val(d.CodigoPostal)}});